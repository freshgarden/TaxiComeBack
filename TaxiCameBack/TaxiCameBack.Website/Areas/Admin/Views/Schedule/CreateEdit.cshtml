@{
    ViewBag.Title = "Schedule";
}
@Html.AntiForgeryToken()
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="~/Scripts/knockout-2.2.0.js"></script>
<script src="~/Scripts/knockout.validation.js"></script>
<script src="~/Scripts/aftp.js"></script>
<form action="#" id="form" onsubmit="GetRoute(); return false;">
    <table class="table">
        <tr>
            <th colspan="3">Schedule Information</th>
        </tr>
        <tr></tr>
        <tbody data-bind="with: schedule">
            <tr>
                <td>
                    <input id="txtSource" class="input-large" data-bind="value: BeginLocation, valueUpdate: 'afterkeydown'" placeholder="Begin Location" />
                </td>
                <td>
                    <input id="txtDestination" class="input-large" data-bind="value: EndLocation, valueUpdate: 'afterkeydown'" placeholder="End Location" />
                </td>
                <td>
                    <input class="input-large" id="txtStartDate" data-bind="value: StartDate, valueUpdate: 'afterkeydown'" placeholder="Start Date" />
                </td>
            </tr>
        </tbody>
    </table>
</form>
<hr />
<button class="btn btn-small btn-success" data-bind="click: saveSchedule">Save Schedule</button>
<input class="btn btn-small btn-primary" type="button" value="Back To Schedule List" data-bind="click:$root.backToScheduleList" />

<hr />
<div id="dvMap" style="width: 1150px; height: 400px; float: left;"></div>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=places&sensor=false&key=AIzaSyAjnlRqvU0vljMnlPB7Y6gmBAUk4ShnAXQ"></script>
@*<script src="~/Scripts/aftp.js"></script>*@
<script src="~/Scripts/ScheduleCreateEdit.js"></script>
<script>
    var source, destination;
    var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();
    google.maps.event.addDomListener(window, 'load', function () {
        new google.maps.places.SearchBox(document.getElementById('txtSource'));
        new google.maps.places.SearchBox(document.getElementById('txtDestination'));
        directionsDisplay = new google.maps.DirectionsRenderer({ 'draggable': true });
        var mumbai = new google.maps.LatLng(21.0031201, 105.82013870000003);
        var mapOptions = {
            zoom: 7,
            center: mumbai
        };
        map = new google.maps.Map(document.getElementById('dvMap'), mapOptions);
        directionsDisplay.setMap(map);
    });
    $(function () {
        $('#form').each(function () {
            $('input').keypress(function (e) {
                // Enter pressed?
                if (e.which == 10 || e.which == 13) {
                    $('#form').submit();
                }
            });

            $('input[type=submit]').hide();
        });
    });


    function GetRoute() {

//        directionsDisplay.setPanel(document.getElementById('dvPanel'));

        //*********DIRECTIONS AND ROUTE**********************//
        source = document.getElementById("txtSource").value;
        destination = document.getElementById("txtDestination").value;

        var request = {
            origin: source,
            destination: destination,
            travelMode: google.maps.TravelMode.DRIVING
        };
        directionsService.route(request, function (response, status) {
            if (status === google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                SetScheduleGeolocation(response);
            }
        });
    }

    function SetScheduleGeolocation(response) {
        var rleg = response.routes[0].legs[0];
        var wp = response.routes[0].overview_path;
        window.vm.addScheduleGeolocation([rleg.start_location.lat(), rleg.start_location.lng()]);
        for (var i = 0; i < wp.length; i++) {
            window.vm.addScheduleGeolocation([wp[i].lat(), wp[i].lng()]);
        }
        window.vm.addScheduleGeolocation([rleg.end_location.lat(), rleg.end_location.lng()]);
    }

    $("#txtStartDate").datepicker({
        dateFormat: 'dd/mm/yy',
        minDate: 0
    });
</script>

<style>
    .validationMessage {
        color: red;
        font-size: 0.8em;
    }
</style>